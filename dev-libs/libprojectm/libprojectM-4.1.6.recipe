SUMMARY="ProjectM - Milkdrop-esque visualisation SDK"
DESCRIPTION="Milkdrop-esque visualisation SDK"
HOMEPAGE="http://github.com/jiixyj/epoll-shim/"
COPYRIGHT="2003-2009 projectM Team"
LICENSE="GNU LGPL v2.1"
REVISION="1"
SOURCE_URI="https://github.com/projectM-visualizer/projectm/releases/download/v$portVersion/libprojectM-$portVersion.tar.gz"
#https://github.com/projectM-visualizer/projectm/releases/download/v4.1.6/libprojectM-4.1.6.tar.gz
CHECKSUM_SHA256="1b9e6d56c59fe24e5416da4d42e941a34c982811003e43ac88b5aca8afa52c87"
SOURCE_FILENAME="libprojectM-$portVersion.tar.gz"
SOURCE_DIR="libprojectM-$portVersion"
#PATCHES=""


ARCHITECTURES="?all !x86_gcc2"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	libprojectM4$secondaryArchSuffix = $portVersion
	lib:libprojectM4$secondaryArchSuffix
	lib:libprojectM4playlist$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	libprojectM4${secondaryArchSuffix}_devel = $portVersion
	devel:libprojectM4$secondaryArchSuffix
	devel:libprojectM4playlist$secondaryArchSuffix
	"
REQUIRES_devel="
		cmd:gcc$secondaryArchSuffix
		devel:libGL$secondaryArchSuffix
		devel:libSDL2_2.0$secondaryArchSuffix
		devel:poco_devel$secondaryArchSuffix
	"

BUILD_REQUIRES="
	#haiku${secondaryArchSuffix}_devel
	lib:libGL$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:poco$secondaryArchSuffix
	
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	cmake -B build -S . -DCMAKE_BUILD_TYPE=Release
	make -C build 
}

INSTALL()
{
	make -C build install

	#mv $prefix/libdata/* $libDir
	#rmdir $prefix/libdata
	prepareInstalledDevelLibs libprojectM-4-playlist.so.4.1.6 libprojectM-4.so.4.1.6
	fixPkgconfig

	packageEntries devel \
		$developDir \
		$libDir/cmake
}

TEST()
{
	cd build
	ctest --output-on-failure
}
